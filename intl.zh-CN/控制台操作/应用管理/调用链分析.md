# 调用链分析

通过调用链分析页面对应用的调用链信息进行分析后，您可以查看链路中部分监控指标的时序曲线，以及调用链列表、应用拓扑和全链路聚合信息。

## 功能入口

1.  登录[链路追踪Tracing Analysis控制台](https://tracing-sg.console.aliyun.com/)。

2.  在左侧导航栏中单击**应用列表**。

3.  在应用列表页面顶部选择地域，然后单击目标应用名称。

4.  在左侧导航栏中单击**调用链分析**。

    ![Trace Analysis](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0036677161/p63933.png)


## 开启全量实时分析

如果您需要对指定采样比例的存储数据进行全量实时分析，您可以在设置指定采样比例后，开启实时全量分析功能，查看对应的调用链信息。设置指定采样比例的操作，请参见[采样存储](/intl.zh-CN/控制台操作/集群配置/采样存储.md)。

**说明：** 如果没有设置采样比例或者采样比例设置为100%，那么开启实时全量分析功能后，显示的数据为当前账号下的存储数据。

1.  在调用链分析页面右上角单击**开启全量实时分析**。

2.  在右侧选择需要全量分析的时间段。

    调用链分析页面将实时刷新当前时间段的全量分析数据。


## 筛选调用链

1.  单击调用链分析页面右上角的时间选择框，设置查询时间范围。

2.  单击调用链分析页面顶部文本框，在弹出的筛选窗口中进行以下操作后，单击**搜索**。

    -   在**耗时**参数后输入响应时间的最小值和最大值，可查询此耗时区间的调用链信息。
    -   选中**异常**复选框，可查询有异常的调用链信息。
    -   添加**Span名称**、**机器/IP**或**标签**三个过滤条件。在添加过滤条件时，可添加多个**Span名称**、**机器/IP**或**标签**。

## 时间变化趋势

**时间变化趋势**区域显示Span数量和异常数的时序曲线、Span耗时趋势曲线图和Span耗时分布图。

![xTrace调用链分析-时间变化趋势](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5997288161/p264473.png)

1.  在**时间变化趋势**区域下，您可以执行以下操作：

    -   将光标移到统计图上，查看统计情况。
    -   使用光标选中一段时间，查看指定时间段的统计情况。
    -   单击图例，隐藏或显示数据。

## Span名称和机器/IP列表

在Span名称和机器/IP区域显示了所有Span和机器的列表。

![xTrace调用链分析-span列表](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0112609161/p264474.png)

1.  在Span名称和机器/IP区域下，您可以执行以下操作：

    -   在列表文本框中输入关键字，单击搜索图标，可以筛选当前列表中的Span名称或机器/IP。
    -   单击列表右上角的**Span数量**或**响应时间**，可以将列表按Span数量或响应时间从大到小排序。
    -   单击Span名称或机器的IP，可以将目标Span名称或机器的IP设置为筛选条件。

## 分组列表

1.  在调用链分析页面的分组依据区域设置分组字段。

2.  在右侧选择查询列表范围为所有Span或接口调用。

    -   所有Span：基于所有Span查询的当前字段的分组列表。
    -   接口调用：基于第一个Span查询的当前字段的分组列表。
    单击字段名称，可以查看当前字段名称对应的调用链列表。


## 调用链

在调用链区域显示了调用链的TraceId、时间、Span名称、耗时和IP。

![xTrace调用链分析-调用链](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5997288161/p265307.png)

1.  在调用链区域下，您可以执行以下操作：

    -   单击调用链TraceId，可以查询目标调用链的调用链瀑布图，更多信息，请参见[调用链瀑布图](#section_nn0_y6s_g63)。
    -   将鼠标悬浮于Span名称上，可以查看该Span的时长、开始时间、Tag和日志事件等信息。

## 应用拓扑

应用拓扑主要展示应用间依赖关系的拓扑图，以及各应用之间的请求比例、调用倍数和耗时比例等信息。基于性能体验考虑，应用拓扑最多支持拉取5000条链路请求进行聚合。

![Trace Topology ](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3754321261/p66600.png)

**说明：**

-   请求比例=应用对外调用的请求数/应用总请求数。 例如有100个请求进入上层应用A， 而从A调用下层应用B的只有90个请求，那么A到B的请求比例为90%。（因为在应用A中，可能存在if判断进行过滤，导致一些请求不会进入应用B。）
-   调用倍数=应用对外调用的Span数/应用总Span数。例如有100个Span进入上层应用A， 而从A调用下层应用B的有300个Span，那么A到B的调用倍数为3。 例如A到B显示为90%/3x， 表示应用A中有90%的请求会去调用应用B，应用A平均调用3次应用B。

## 全链路聚合

全链路聚合是将调用链根据Span名称和应用名进行聚合的调用链路表。基于性能体验考虑，实时聚合最多支持拉取5000条链路请求进行聚合。

![Trace Real-time Aggregation](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3750368061/p66616.png)

**说明：**

-   请求数/请求比例：请求比例表示调用当前Span节点的请求比例数。例如总请求数为100个，请求比例为10%表示有10个请求调用当前Span。计算公式=当前Span的请求数/总请求数×100%。
-   Span数/请求倍数：请求倍数表示平均每个请求数调用当前Span的次数，例如1.5x表示平均每个请求会调用当前Span 1.5次 。计算公式=Span数/Span的请求数。
-   平均自身耗时/比例：平均自身耗时表示不包括子Span的平均耗时，例如Span A到B中，A耗时为10毫秒，B耗时为8毫秒，那么A的自身耗时为2毫秒。计算公式=Span耗时-Sum（子Span耗时）。如果是异步调用的话，将不会减去子耗时，计算公式=Span耗时。
-   异常数/异常比例：异常比例表示出现异常的请求比例，例如3%表示有3%的请求出现异常。计算公式=异常请求数/总请求数。异常请求数不等于异常数，当请求倍数大于1时，一个异常请求可能对应多个异常数。

1.  在调用链区域下，您可以执行以下操作：

    -   单击调用链TraceId，可以查询目标调用链的调用链瀑布图，更多信息，请参见[调用链瀑布图](#section_nn0_y6s_g63)。
    -   将鼠标悬浮于蓝色Span名称上，显示推荐调用链提示信息，可查看与此Span关联的调用链。单击TraceId，显示调用链瀑布图，更多信息，请参见[调用链瀑布图](#section_nn0_y6s_g63)。
    -   单击应用名称，可以查看目标应用的应用总览，更多信息，请参见[查看应用性能关键指标和拓扑图](/intl.zh-CN/控制台操作/应用管理/查看应用性能关键指标和拓扑图.md)。

## 调用链瀑布图

在调用链路页面上，您可以看到调用链的Span名称、时间轴、应用名、开始时间、IP地址和状态等信息。

**说明：** **IP地址**字段显示的是IP地址还是机器名称，取决于应用设置页面上的显示配置。更多信息，请参见[管理应用和标签](/intl.zh-CN/控制台操作/应用管理/管理应用和标签.md)。

![Page Trace](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3750368061/p63969.png)

1.  在调用链区域下，您可以执行以下操作：

    将鼠标悬浮于Span名称上，可以查看该Span的时长、开始时间、Tag和日志事件等信息。

    ![Overlay Tag and Log Events](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3750368061/p63977.png)


